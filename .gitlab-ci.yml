stages:
  - test
  - build

before_script:
  - dart pub get

test:
  image: dart:stable-sdk
  stage: test
  script:
    - dart test
  tags:
    - docker
  
build-linux:
  image: dart:stable-sdk
  stage: build
  script:
    - dart compile exe bin/aoc2015.dart -o aoc2015-linux-x64 --target-os linux
  artifacts:
    paths:
      - aoc2015-linux-x64
      - data/*.txt
  tags:
    - docker
  only:
    - /^feature/.*$/
    - main

build-macos:
  stage: build
  script:
    - /opt/homebrew/Caskroom/flutter/3.13.0/flutter/bin/cache/dart-sdk/bin//dart compile exe bin/aoc2015.dart -o aoc2015-darwin-x64 --target-os macos
  artifacts:
    paths:
      - aoc2015-darwin-x64
      - data/*.txt
  tags:
    - macos
  only:
    - /^feature/.*$/
    - main

build-windows:
  stage: build
  script:
    - dart compile exe bin/aoc2015.dart -o aoc2015-windows-x64.exe --target-os windows
  artifacts:
    paths:
      - aoc2015-windows-x64.exe
      - data/*.txt
  tags:
    - windows
  only:
    - /^feature/.*$/
    - main
